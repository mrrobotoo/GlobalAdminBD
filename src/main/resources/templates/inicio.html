<!DOCTYPE html>
<html lang="en">

<head>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
		crossorigin="anonymous"></script>
		<link rel="stylesheet" href="styles.css">

	<title>Registros</title>
</head>

<body>
	<div th:include="navbar.html"></div> <!-- IMPORTAMOS EL NAVBAR -->

	<table class="table table-dark" style="margin-bottom: 3.95%;">
		<thead class="thead-dark">
			<tr>
				<th style="text-align: center;">Nombre</th>
				<th style="text-align: center;">Edad</th>
				<th style="text-align: center;">Sexo</th>
				<th></th>
				<th></th>
			</tr>
		</thead>
		<tbody>
			<tr th:each="item, itemStatus: ${listaPersonas}">
				<td style="text-align: center;" th:text="${item.nombre}"></td>
				<td style="text-align: center;" th:text="${item.edad}"></td>
				<td style="text-align: center;" th:text="${item.sexo}"></td>
				<td>
					<a th:href="@{/eliminar/{id}(id=${item.id})}" class="btn btn-danger">Eliminar</a>
					<!-- BUTTON ELIMINAR PERSONAS -->
				</td>
				<td>
					<div>
						<button class="btn btn-primary" data-bs-toggle="modal"
							th:data-bs-target="'#modalContainer-' + ${item.id}"
							th:attr="data-id=${item.id}">Actualizar</button> <!-- BUTTON ACTUALIZAR PARA CADA FILA -->
						<!-- EL 'TH:ATTR' HACE QUE SE LE ASIGNE UN VALOR DINÁMICO AL 'DATA-ID' QUE ES EL ATRIBUTO DE DATOS Y REPRESENTA EL ID ÚNICO DE LA PERSONA DEPENDIENDO DE LA FILA EN LA QUE SE ENCUENTRA EL BOTÓN -->
						<div class="modal fade" th:id="'modalContainer-' + ${item.id}" tabindex="-1" role="dialog"
							aria-labelledby="modalTitle" aria-hidden="true"> <!-- CONTENEDOR DEL MODAL -->
							<div class="modal-dialog" role="document">
								<div class="modal-content"> <!-- CONTENEDOR DE MODAL -->
									<div class="modal-header" style="text-align: center;"> <!-- CABECERA DEL MODAL -->
										<h4 class="modal-title" style="color: black; text-align: center; margin: auto auto;;">Actualizar Datos</h4>
										<button type="button" class="btn-close" data-bs-dismiss="modal"
											aria-label="Close"></button> <!-- BUTTON 'X' PARA CERRAR EL MODAL -->
									</div>
									<div class="modal-body"> <!-- CUERPO DEL MODAL -->
										<center> <!-- CENTRAMOS EL CONTENIDO -->
											<form style="max-width: max-content;" th:action="@{/actualizar/{id}(id=${item.id})}"
												class="p-3 mb-2 bg-dark text-white" method="post">
												<!-- FORMULARIO PARA ACTUALIZAR -->
												<input type="hidden" name="id" th:value="${item.id}" />
												<!-- CAMPO OCULTO PARA TRAER EL ID DE LA PERSONA -->
												<table border="10px" style="padding: 10px; border-style: solid;">
													<tr>
														<td style="text-align: right; padding: 10px;"><label
																for="nombre" class="label label-primary"
																style="text-align: right">Nombre: </label></td>
														<td style="padding-right: 10px; padding-top: 10px;"><input
																style="text-align: center;" id="NombreInput"
																placeholder="Ingresa un nombre" type="text"
																name="nombre" th:value="${item.nombre}" /></td>
													</tr>
													<tr>
														<td style="text-align: right; padding: 10px;"><label for="edad"
																style="text-align: right">Edad: </label></td>
														<td><input style="text-align: center"
																placeholder="Ingresa la edad" type="text" name="edad"
																th:value="${item.edad}" /></td>
													</tr>
													<tr>
														<td style="text-align: right; padding: 10px;"><label for="sexo"
																style="text-align: right">Sexo: </label></td>
														<td><input style="text-align: center" placeholder="H/M/NB"
																type="text" name="sexo" th:value="${item.sexo}" /></td>
													</tr>
													<tr>
														<td align="center"></td>
														<td
															style="padding-left: 0px; padding-top: 10px; padding-bottom: 10px;">
															<input type="submit" value="Actualizar"
																class="btn btn-success" />
														</td>
													</tr>
												</table>
											</form>
										</center>
									</div>
								</div>
							</div>
						</div>
					</div>
				</td>
			</tr>
		</tbody>
	</table>

	<div th:include="footer.html"></div>

	<script>
		const openModalButtons = document.querySelectorAll('.btn-primary[data-bs-toggle="modal"]');
		const closeModalButtons = document.querySelectorAll('.btn-close[data-bs-dismiss="modal"]');

		openModalButtons.forEach((button) => {
			button.addEventListener('click', (event) => {
				const id = event.currentTarget.getAttribute('data-id');
				const modalContainer = document.getElementById(`modalContainer-${id}`);
				const form = modalContainer.querySelector('form');
				form.action = `/actualizar/${id}`;
				form.reset();

				const nombreInput = form.querySelector('input[name="nombre"]');
				const edadInput = form.querySelector('input[name="edad"]');
				const sexoInput = form.querySelector('input[name="sexo"]');

				const filaSeleccionada = event.currentTarget.closest('tr');
				const nombre = filaSeleccionada.querySelector('td:nth-child(1)').textContent;
				const edad = filaSeleccionada.querySelector('td:nth-child(2)').textContent;
				const sexo = filaSeleccionada.querySelector('td:nth-child(3)').textContent;

				nombreInput.value = nombre;
				edadInput.value = edad;
				sexoInput.value = sexo;
			});
		});

		closeModalButtons.forEach((button) => {
			button.addEventListener('click', () => {
				const modalContainer = button.closest('.modal-container');
				modalContainer.classList.remove('show');
			});
		});
	</script>

</body>

</html>