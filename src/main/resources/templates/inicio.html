<style>
        /* Estilos para el popup */
        .popup {
			display: none;
            position: fixed; /* Permite que el popup se posicione de forma fija */
            z-index: 1; /* Asegura que el popup esté en la parte superior */
            left: 50%; /* Coloca el popup en el centro horizontalmente */
            top: 50%; /* Coloca el popup en el centro verticalmente */
            transform: translate(-50%, -50%); /* Centra el popup exactamente en el medio */
            width:auto;
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); /* Agrega una sombra alrededor del popup */
        }

        /* Estilos para el contenido del popup */
        .popup-content {
            text-align: center;
        }

        /* Estilos para el botón de cierre (x) */
        .close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div th:include="navbar.html"></div>
    <div class="container">
        <!-- Tabla -->
        <table class="table">
            <thead>
                <tr>
                    <th>Edad</th>
                    <th>Nombre</th>
                    <th>Sexo</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="item : ${listaPersonas}" th:data-idUser="${item.idUser}">
                    <td th:text="${item.age}"></td>
                    <td th:text="${item.name}"></td>
                    <td th:text="${item.sex}"></td>
                    <td>
                        <a th:href="@{/eliminar/{idUser}(idUser=${item.idUser})}" class="btn btn-danger">Eliminar</a>
                    </td>
                    <td>
                        <button class="btn btn-info btn-actualizar">Actualizar</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- The Popup -->
        <div id="myPopup" class="popup">
            <div class="popup-content">
                <span class="close">&times;</span>
                <table class="table">
                    <tr class="table-secondary">
                        <th colspan="2">Edad</th>
                    </tr><tr>
                        <td colspan="2"><input type="text" id="popup-edad" required style="border: none;"></td>
                    </tr ><tr class="table-secondary">
                        <th colspan="2">Nombre</th>
                    </tr><tr>
                        <td colspan="2"><input type="text" id="popup-nombre" required style="border: none;"></td>
                    </tr><tr class="table-secondary">   
                        <th colspan="2">Sexo</th>
                    </tr><tr>    
                        <td colspan="2"><input type="text" id="popup-sexo" required style="border: none;"></td>
                    </tr>
                    <tr>
                        <td><a class="btn btn-info guardar">Guardar</a></td>
                        <td><a class="btn btn-danger cancelar">Cancelar</a></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <script>
        var popup = document.getElementById("myPopup");
        var botonesActualizar = document.querySelectorAll('.btn-actualizar');
        var span = document.getElementsByClassName("close")[0];
        var inputsEdad = document.getElementById('popup-edad');
        var inputsNombre = document.getElementById('popup-nombre');
        var inputsSexo = document.getElementById('popup-sexo');

        botonesActualizar.forEach(function (boton) {
            boton.addEventListener('click', function () {
                var filaSeleccionada = this.parentNode.parentNode;
                var idUser = filaSeleccionada.getAttribute('data-idUser');
                var edad = filaSeleccionada.querySelector('td:nth-child(1)').textContent;
                var nombre = filaSeleccionada.querySelector('td:nth-child(2)').textContent;
                var sexo = filaSeleccionada.querySelector('td:nth-child(3)').textContent;

                inputsEdad.value = edad;
                inputsNombre.value = nombre;
                inputsSexo.value = sexo;

                // Almacenar la id del usuario en el botón de guardar
                document.querySelector('.guardar').setAttribute('data-idUser', idUser);

                popup.style.display = "block";
            });
        });

        span.onclick = function () {
            popup.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target == popup) {
                popup.style.display = "none";
            }
        }

        document.querySelector('.guardar').addEventListener('click', function () {
            var idUser = this.getAttribute('data-idUser');
            var filaSeleccionada = document.querySelector('tr[data-idUser="' + idUser + '"]');
            var edad = inputsEdad.value;
            var nombre = inputsNombre.value;
            var sexo = inputsSexo.value;

            var data = {
                idUser: idUser,
                name: nombre,
                age: edad,
                sex: sexo
            };

            // Realizar petición AJAX para actualizar los datos en el servidor
            fetch('/person?idUser=' + idUser, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(function (response) {
                if (response.ok) {
                    // Actualizar los datos en la tabla
                    filaSeleccionada.querySelector('td:nth-child(1)').textContent = edad;
                    filaSeleccionada.querySelector('td:nth-child(2)').textContent = nombre;
                    filaSeleccionada.querySelector('td:nth-child(3)').textContent = sexo;
                    popup.style.display = "none";
                } else {
                    console.error('Error al realizar la petición');
                }
            })
            .catch(function (error) {
                console.error('Error en la petición:', error);
            });
        });

        document.querySelector('.cancelar').addEventListener('click', function () {
            popup.style.display = "none";
        });
    </script>

    <script src="extensions/editable/bootstrap-table-editable.js"></script>

    <div th:include="footer.html" name="footer"></div>